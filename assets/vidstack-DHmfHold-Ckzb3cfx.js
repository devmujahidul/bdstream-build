var t,e,i,s,a,o,n,h,r,l,c,u,d,p,f,y,m,v,g,k,b=Object.defineProperty,w=t=>{throw TypeError(t)},M=(t,e,i)=>((t,e,i)=>e in t?b(t,e,{enumerable:!0,configurable:!0,writable:!0,value:i}):t[e]=i)(t,"symbol"!=typeof e?e+"":e,i),$=(t,e,i)=>e.has(t)||w("Cannot "+i),S=(t,e,i)=>($(t,e,"read from private field"),i?i.call(t):e.get(t)),T=(t,e,i)=>e.has(t)?w("Cannot add the same private member more than once"):e instanceof WeakSet?e.add(t):e.set(t,i),j=(t,e,i,s)=>($(t,e,"write to private field"),s?s.call(t,i):e.set(t,i),i),W=(t,e,i)=>($(t,e,"access private method"),i);import{m as R,n as V,p as C,e as D,b as E,q as _,o as O,t as P,u as x,v as F}from"./main-ivqbj34p.js";import{E as I}from"./vidstack-FldwQc2Q-D_7Mk-Sh.js";import{resolveYouTubeVideoId as L}from"./vidstack-Dm1xEU9Q-CvQ_TGZE.js";import"./vendor-I5pfZzyJ.js";import"./mui-Du5OpAyb.js";import"./router-C70wdWFB.js";const Q=0,U=1,B=2,Y=3,q=5;class z extends I{constructor(r,l){super(r),T(this,h),M(this,"$$PROVIDER_TYPE","YOUTUBE"),M(this,"scope",R()),T(this,t),T(this,e,V("")),T(this,i,-1),T(this,s,null),T(this,a,-1),T(this,o,!1),T(this,n,new Map),M(this,"language","en"),M(this,"color","red"),M(this,"cookies",!1),j(this,t,l)}get currentSrc(){return S(this,s)}get type(){return"youtube"}get videoId(){return S(this,e).call(this)}preconnect(){C(this.getOrigin())}setup(){super.setup(),D(W(this,h,r).bind(this)),S(this,t).notify("provider-setup",this)}destroy(){W(this,h,v).call(this);for(const t of S(this,n).values())for(const{reject:e}of t)e("provider destroyed");S(this,n).clear()}async play(){return W(this,h,l).call(this,"playVideo")}async pause(){return W(this,h,l).call(this,"pauseVideo")}setMuted(t){t?W(this,h,l).call(this,"mute"):W(this,h,l).call(this,"unMute")}setCurrentTime(e){W(this,h,l).call(this,"seekTo",e),S(this,t).notify("seeking",e)}setVolume(t){W(this,h,l).call(this,"setVolume",100*t)}setPlaybackRate(t){W(this,h,l).call(this,"setPlaybackRate",t)}async loadSource(t){if(!E(t.src))return j(this,s,null),void S(this,e).set("");const i=L(t.src);S(this,e).set(i??""),j(this,s,t)}getOrigin(){return this.cookies?"https://www.youtube.com":"https://www.youtube-nocookie.com"}buildParams(){const{keyDisabled:e}=S(this,t).$props,{muted:i,playsInline:s,nativeControls:a}=S(this,t).$state,o=a();return{rel:0,autoplay:0,cc_lang_pref:this.language,cc_load_policy:o?1:void 0,color:this.color,controls:o?1:0,disablekb:!o||e()?1:0,enablejsapi:1,fs:1,hl:this.language,iv_load_policy:o?1:3,mute:i()?1:0,playsinline:s()?1:0}}onLoad(){window.setTimeout(()=>this.postMessage({event:"listening"}),100)}onMessage({info:e},s){var a;if(!e)return;const{title:n,intrinsicDuration:r,playbackRate:l}=S(this,t).$state;if(P(e.videoData)&&e.videoData.title!==n()&&S(this,t).notify("title-change",e.videoData.title,s),x(e.duration)&&e.duration!==r()){if(x(e.videoLoadedFraction)){const t=(null==(a=e.progressState)?void 0:a.loaded)??e.videoLoadedFraction*e.duration,i=new O(0,e.duration);W(this,h,p).call(this,t,i,s)}S(this,t).notify("duration-change",e.duration,s)}if(x(e.playbackRate)&&e.playbackRate!==l()&&S(this,t).notify("rate-change",e.playbackRate,s),e.progressState){const{current:i,seekableStart:a,seekableEnd:o,loaded:n,duration:l}=e.progressState;W(this,h,d).call(this,i,s),W(this,h,p).call(this,n,new O(a,o),s),l!==r()&&S(this,t).notify("duration-change",l,s)}if(x(e.volume)&&F(e.muted)&&!S(this,o)){const i={muted:e.muted,volume:e.volume/100};S(this,t).notify("volume-change",i,s)}x(e.playerState)&&e.playerState!==S(this,i)&&W(this,h,m).call(this,e.playerState,s)}}t=new WeakMap,e=new WeakMap,i=new WeakMap,s=new WeakMap,a=new WeakMap,o=new WeakMap,n=new WeakMap,h=new WeakSet,r=function(){W(this,h,v).call(this);const i=S(this,e).call(this);i?(this.src.set(`${this.getOrigin()}/embed/${i}`),S(this,t).notify("load-start")):this.src.set("")},l=function(t,e){let i=_(),s=S(this,n).get(t);return s||S(this,n).set(t,s=[]),s.push(i),this.postMessage({event:"command",func:t,args:e?[e]:void 0}),i.promise},c=function(e){S(this,t).notify("loaded-metadata"),S(this,t).notify("loaded-data"),S(this,t).delegate.ready(void 0,e)},u=function(e){var i;null==(i=W(this,h,g).call(this,"pauseVideo"))||i.resolve(),S(this,t).notify("pause",void 0,e)},d=function(e,s){const{duration:a,realCurrentTime:o}=S(this,t).$state,n=S(this,i)===Q,h=n?a():e;S(this,t).notify("time-change",h,s),!n&&Math.abs(h-o())>1&&S(this,t).notify("seeking",h,s)},p=function(e,i,s){const a={buffered:new O(0,e),seekable:i};S(this,t).notify("progress",a,s);const{seeking:o,realCurrentTime:n}=S(this,t).$state;o()&&e>n()&&W(this,h,f).call(this,s)},f=function(e){const{paused:i,realCurrentTime:s}=S(this,t).$state;window.clearTimeout(S(this,a)),j(this,a,window.setTimeout(()=>{S(this,t).notify("seeked",s(),e),j(this,a,-1)},i()?100:0))},y=function(e){const{seeking:i}=S(this,t).$state;i()&&W(this,h,f).call(this,e),S(this,t).notify("pause",void 0,e),S(this,t).notify("end",void 0,e)},m=function(e,s){var a;const{paused:n,seeking:r}=S(this,t).$state,l=e===U,d=e===Y,p=W(this,h,k).call(this,"playVideo"),m=n()&&(d||l);if(d&&S(this,t).notify("waiting",void 0,s),r()&&l&&W(this,h,f).call(this,s),S(this,o)&&l)return this.pause(),j(this,o,!1),void this.setMuted(S(this,t).$state.muted());if(!p&&m)return j(this,o,!0),void this.setMuted(!0);switch(m&&(null==(a=W(this,h,g).call(this,"playVideo"))||a.resolve(),S(this,t).notify("play",void 0,s)),e){case q:W(this,h,c).call(this,s);break;case U:S(this,t).notify("playing",void 0,s);break;case B:W(this,h,u).call(this,s);break;case Q:W(this,h,y).call(this,s)}j(this,i,e)},v=function(){j(this,i,-1),j(this,a,-1),j(this,o,!1)},g=function(t){var e;return null==(e=S(this,n).get(t))?void 0:e.shift()},k=function(t){var e;return Boolean(null==(e=S(this,n).get(t))?void 0:e.length)};export{z as YouTubeProvider};
