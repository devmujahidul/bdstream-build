const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/errors-B9BloU_q.js","assets/prod-Ba2QW_G_.js","assets/main-DFeOjnqW.js","assets/mui-Du5OpAyb.js","assets/vendor-I5pfZzyJ.js","assets/router-C70wdWFB.js","assets/main-DDo056iP.css"])))=>i.map(i=>d[i]);
var e=Object.defineProperty,t=(t,s,a)=>((t,s,a)=>s in t?e(t,s,{enumerable:!0,configurable:!0,writable:!0,value:a}):t[s]=a)(t,"symbol"!=typeof s?s+"":s,a);import{_ as s}from"./main-DFeOjnqW.js";import{b as a,p as r}from"./prod-Ba2QW_G_.js";import"./mui-Du5OpAyb.js";import"./vendor-I5pfZzyJ.js";import"./router-C70wdWFB.js";const i=/^Format:[\s\t]*/,l=/^Style:[\s\t]*/,n=/^Dialogue:[\s\t]*/,c=/[\s\t]*,[\s\t]*/,o=/\{[^}]+\}/g,h=/\\N/g,u=/^\[(.*)[\s\t]?Styles\]$/,p=/^\[(.*)[\s\t]?Events\]$/;class f{constructor(){t(this,"h"),t(this,"O",0),t(this,"c",null),t(this,"l",[]),t(this,"m",[]),t(this,"N",null),t(this,"f"),t(this,"P",{})}async init(e){this.h=e,e.errors&&(this.f=(await s(async()=>{const{ParseErrorBuilder:e}=await import("./errors-B9BloU_q.js");return{ParseErrorBuilder:e}},__vite__mapDeps([0,1,2,3,4,5,6]))).ParseErrorBuilder)}parse(e,t){var s,a;if(this.O)switch(this.O){case 1:if(""===e)this.O=0;else if(l.test(e))if(this.N){const t=e.replace(l,"").split(c);this.S(t)}else this.g(null==(s=this.f)?void 0:s.T("Style",t));else i.test(e)?this.N=e.replace(i,"").split(c):p.test(e)&&(this.N=null,this.O=2);break;case 2:if(""===e)this.Q();else if(n.test(e))if(this.Q(),this.N){const s=e.replace(n,"").split(c),a=this.U(s,t);a&&(this.c=a)}else this.g(null==(a=this.f)?void 0:a.T("Dialogue",t));else this.c?this.c.text+="\n"+e.replace(o,"").replace(h,"\n"):i.test(e)?this.N=e.replace(i,"").split(c):u.test(e)?(this.N=null,this.O=1):p.test(e)&&(this.N=null)}else""===e||(u.test(e)?(this.N=null,this.O=1):p.test(e)&&(this.N=null,this.O=2))}done(){return{metadata:{},cues:this.l,regions:[],errors:this.m}}Q(){var e,t;this.c&&(this.l.push(this.c),null==(t=(e=this.h).onCue)||t.call(e,this.c),this.c=null)}S(e){let t,s,a,r,i="Default",l={},n="center",c="bottom",o=1.2,h=3,u=[];for(let p=0;p<this.N.length;p++){const f=this.N[p],b=e[p];switch(f){case"Name":i=b;break;case"Fontname":l["font-family"]=b;break;case"Fontsize":l["font-size"]=`calc(${b} / var(--overlay-height))`;break;case"PrimaryColour":const e=g(b);e&&(l["--cue-color"]=e);break;case"BorderStyle":h=parseInt(b,10);break;case"BackColour":r=g(b);break;case"OutlineColour":const p=g(b);p&&(a=p);break;case"Bold":parseInt(b)&&(l["font-weight"]="bold");break;case"Italic":parseInt(b)&&(l["font-style"]="italic");break;case"Underline":parseInt(b)&&(l["text-decoration"]="underline");break;case"StrikeOut":parseInt(b)&&(l["text-decoration"]="line-through");break;case"Spacing":l["letter-spacing"]=b+"px";break;case"AlphaLevel":l.opacity=parseFloat(b);break;case"ScaleX":u.push(`scaleX(${parseFloat(b)/100})`);break;case"ScaleY":u.push(`scaleY(${parseFloat(b)/100})`);break;case"Angle":u.push(`rotate(${b}deg)`);break;case"Shadow":o=1.2*parseInt(b,10);break;case"MarginL":l["--cue-width"]="auto",l["--cue-left"]=parseFloat(b)+"px";break;case"MarginR":l["--cue-width"]="auto",l["--cue-right"]=parseFloat(b)+"px";break;case"MarginV":s=parseFloat(b);break;case"Outline":t=parseInt(b,10);break;case"Alignment":const f=parseInt(b,10);switch(f>=4&&(c=f>=7?"top":"center"),f%3){case 1:n="start";break;case 2:n="center";break;case 3:n="end"}}}if(l.R=c,l["--cue-white-space"]="normal",l["--cue-line-height"]="normal",l["--cue-text-align"]=n,"center"===c?(l["--cue-top"]="50%",u.push("translateY(-50%)")):l[`--cue-${c}`]=(s||0)+"px",1===h&&(l["--cue-padding-y"]="0"),(1===h||r)&&(l["--cue-bg-color"]=1===h?"none":r),3===h&&a&&(l["--cue-outline"]=`${t}px solid ${a}`),1===h&&"number"==typeof t){const e=r??"#000";l["--cue-text-shadow"]=[a&&b(1.2*t,1.2*o,a),a?b(t*(t/2),o*(t/2),e):b(t,o,e)].filter(Boolean).join(", ")}u.length&&(l["--cue-transform"]=u.join(" ")),this.P[i]=l}U(e,t){const s=this.V(e),r=this.q(s.Start,s.End,t);if(!r)return;const i=new a(r[0],r[1],""),l={...this.P[s.Style]||{}},n=s.Name?`<v ${s.Name}>`:"",c=l.R,u=s.MarginL&&parseFloat(s.MarginL),p=s.MarginR&&parseFloat(s.MarginR),f=s.MarginV&&parseFloat(s.MarginV);return u&&(l["--cue-width"]="auto",l["--cue-left"]=u+"px"),p&&(l["--cue-width"]="auto",l["--cue-right"]=p+"px"),f&&"center"!==c&&(l[`--cue-${c}`]=f+"px"),i.text=n+e.slice(this.N.length-1).join(", ").replace(o,"").replace(h,"\n"),delete l.R,Object.keys(l).length&&(i.style=l),i}V(e){const t={};for(let s=0;s<this.N.length;s++)t[this.N[s]]=e[s];return t}q(e,t,s){var a,i,l;const n=r(e),c=r(t);if(null!==n&&null!==c&&c>n)return[n,c];null===n&&this.g(null==(a=this.f)?void 0:a.s(e,s)),null===c&&this.g(null==(i=this.f)?void 0:i.t(t,s)),null!=n&&null!==c&&c>n&&this.g(null==(l=this.f)?void 0:l.u(n,c,s))}g(e){var t,s;if(e){if(this.m.push(e),this.h.strict)throw this.h.cancel(),e;null==(s=(t=this.h).onError)||s.call(t,e)}}}function g(e){const t=parseInt(e.replace("&H",""),16);if(t>=0){return"rgba("+[255&t,t>>8&255,t>>16&255,(t>>24&255^255)/255].join(",")+")"}return null}function b(e,t,s){const a=Math.ceil(2*Math.PI*e);let r="";for(let i=0;i<a;i++){const l=2*Math.PI*i/a;r+=e*Math.cos(l)+"px "+t*Math.sin(l)+"px 0 "+s+(i==a-1?"":",")}return r}function d(){return new f}export{f as SSAParser,d as default};
