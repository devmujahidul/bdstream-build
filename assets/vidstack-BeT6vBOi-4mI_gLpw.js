var t,e,s,i,a,n,h,r,o,c,l,u,d,m,f,p,T,y,k,v,g,E,w,S,C,M,L,b,A,I,D,_,N,P,R,W,G,O,$,x,V,U,H,j,B,F,X,K,Y,q,Q,z,J,Z=Object.defineProperty,tt=t=>{throw TypeError(t)},et=(t,e,s)=>((t,e,s)=>e in t?Z(t,e,{enumerable:!0,configurable:!0,writable:!0,value:s}):t[e]=s)(t,"symbol"!=typeof e?e+"":e,s),st=(t,e,s)=>e.has(t)||tt("Cannot "+s),it=(t,e,s)=>(st(t,e,"read from private field"),s?s.call(t):e.get(t)),at=(t,e,s)=>e.has(t)?tt("Cannot add the same private member more than once"):e instanceof WeakSet?e.add(t):e.set(t,s),nt=(t,e,s,i)=>(st(t,e,"write to private field"),i?i.call(t,s):e.set(t,s),s),ht=(t,e,s)=>(st(t,e,"access private method"),s);import{m as rt,o as ot,R as ct,A as lt,B as ut,D as dt,c as mt,l as ft,e as pt,C as Tt,L as yt}from"./main-DFeOjnqW.js";import{getCastContext as kt,getCastSession as vt,getCastSessionMedia as gt,hasActiveCastSession as Et,listenCastContextEvent as wt,getCastErrorMessage as St}from"./vidstack-CQQ1xKSy-B4-HFS1P.js";import"./vendor-I5pfZzyJ.js";import"./mui-Du5OpAyb.js";import"./router-C70wdWFB.js";class Ct{constructor(s){at(this,e),at(this,t),nt(this,t,new chrome.cast.media.MediaInfo(s.src,s.type))}build(){return it(this,t)}setStreamType(e){return e.includes("live")?it(this,t).streamType=chrome.cast.media.StreamType.LIVE:it(this,t).streamType=chrome.cast.media.StreamType.BUFFERED,this}setTracks(i){return it(this,t).tracks=i.map(ht(this,e,s)),this}setMetadata(e,s){return it(this,t).metadata=new chrome.cast.media.GenericMediaMetadata,it(this,t).metadata.title=e,it(this,t).metadata.images=[{url:s}],this}}t=new WeakMap,e=new WeakSet,s=function(t,e){const s=new chrome.cast.media.Track(e,chrome.cast.media.TrackType.TEXT);return s.name=t.label,s.trackContentId=t.src,s.trackContentType="text/vtt",s.language=t.language,s.subtype=t.kind.toUpperCase(),s};class Mt{constructor(t,e,s){at(this,h),at(this,i),at(this,a),at(this,n),nt(this,i,t),nt(this,a,e),nt(this,n,s)}setup(){const t=this.syncRemoteActiveIds.bind(this);ft(it(this,a).audioTracks,"change",t),ft(it(this,a).textTracks,"mode-change",t),pt(ht(this,h,l).bind(this))}getLocalTextTracks(){return it(this,a).$state.textTracks().filter(t=>t.src&&"vtt"===t.type)}syncRemoteTracks(t){if(!it(this,i).isMediaLoaded)return;const e=ht(this,h,r).call(this),s=this.getLocalTextTracks(),n=ht(this,h,o).call(this,chrome.cast.media.TrackType.AUDIO),c=ht(this,h,o).call(this,chrome.cast.media.TrackType.TEXT);for(const i of n){if(ht(this,h,d).call(this,e,i))continue;const s={id:i.trackId.toString(),label:i.name,language:i.language,kind:i.subtype??"main",selected:!1};it(this,a).audioTracks[yt.add](s,t)}for(const i of c){if(ht(this,h,d).call(this,s,i))continue;const e={id:i.trackId.toString(),src:i.trackContentId,label:i.name,language:i.language,kind:i.subtype.toLowerCase()};it(this,a).textTracks.add(e,t)}}syncRemoteActiveIds(t){if(!it(this,i).isMediaLoaded)return;const e=ht(this,h,c).call(this),s=new chrome.cast.media.EditTracksInfoRequest(e);ht(this,h,u).call(this,s).catch(t=>{})}}i=new WeakMap,a=new WeakMap,n=new WeakMap,h=new WeakSet,r=function(){return it(this,a).$state.audioTracks()},o=function(t){var e;const s=(null==(e=it(this,i).mediaInfo)?void 0:e.tracks)??[];return t?s.filter(e=>e.type===t):s},c=function(){const t=[],e=ht(this,h,r).call(this).find(t=>t.selected),s=this.getLocalTextTracks().filter(t=>"showing"===t.mode);if(e){const s=ht(this,h,o).call(this,chrome.cast.media.TrackType.AUDIO),i=ht(this,h,m).call(this,s,e);i&&t.push(i.trackId)}if(null==s?void 0:s.length){const e=ht(this,h,o).call(this,chrome.cast.media.TrackType.TEXT);if(e.length)for(const i of s){const s=ht(this,h,m).call(this,e,i);s&&t.push(s.trackId)}}return t},l=function(){const t=this.getLocalTextTracks();if(!it(this,i).isMediaLoaded)return;const e=ht(this,h,o).call(this,chrome.cast.media.TrackType.TEXT);for(const s of t){if(!ht(this,h,m).call(this,e,s)){Tt(()=>{var t;return null==(t=it(this,n))?void 0:t.call(this)});break}}},u=function(t){const e=gt();return new Promise((s,i)=>null==e?void 0:e.editTracksInfo(t,s,i))},d=function(t,e){return t.find(t=>ht(this,h,f).call(this,t,e))},m=function(t,e){return t.find(t=>ht(this,h,f).call(this,e,t))},f=function(t,e){return e.name===t.label&&e.language===t.language&&e.subtype.toLowerCase()===t.kind.toLowerCase()};class Lt{constructor(t,e){at(this,b),et(this,"$$PROVIDER_TYPE","GOOGLE_CAST"),et(this,"scope",rt()),at(this,p),at(this,T),at(this,y),at(this,k,null),at(this,v,"disconnected"),at(this,g,0),at(this,E,0),at(this,w,new ot(0,0)),at(this,S,new ct(ht(this,b,R).bind(this))),at(this,C),at(this,M,null),at(this,L,!1),nt(this,p,t),nt(this,T,e),nt(this,y,new Mt(t,e,ht(this,b,J).bind(this)))}get type(){return"google-cast"}get currentSrc(){return it(this,k)}get player(){return it(this,p)}get cast(){return kt()}get session(){return vt()}get media(){return gt()}get hasActiveSession(){return Et(it(this,k))}setup(){ht(this,b,A).call(this),ht(this,b,I).call(this),it(this,y).setup(),it(this,T).notify("provider-setup",this)}async play(){var t;(it(this,p).isPaused||it(this,L))&&(it(this,L)?await ht(this,b,z).call(this,!1,0):null==(t=it(this,p).controller)||t.playOrPause())}async pause(){var t;it(this,p).isPaused||null==(t=it(this,p).controller)||t.playOrPause()}getMediaStatus(t){return new Promise((e,s)=>{var i;null==(i=this.media)||i.getStatus(t,e,s)})}setMuted(t){var e;(t&&!it(this,p).isMuted||!t&&it(this,p).isMuted)&&(null==(e=it(this,p).controller)||e.muteOrUnmute())}setCurrentTime(t){var e;it(this,p).currentTime=t,it(this,T).notify("seeking",t),null==(e=it(this,p).controller)||e.seek()}setVolume(t){var e;it(this,p).volumeLevel=t,null==(e=it(this,p).controller)||e.setVolumeLevel()}async loadSource(t){var e;if((null==(e=it(this,M))?void 0:e.src)!==t&&nt(this,M,null),Et(t))return ht(this,b,_).call(this),void nt(this,k,t);it(this,T).notify("load-start");const s=ht(this,b,Q).call(this,t),i=await this.session.loadMedia(s);if(i)return nt(this,k,null),void it(this,T).notify("error",Error(St(i)));nt(this,k,t)}destroy(){ht(this,b,D).call(this),ht(this,b,N).call(this)}}p=new WeakMap,T=new WeakMap,y=new WeakMap,k=new WeakMap,v=new WeakMap,g=new WeakMap,E=new WeakMap,w=new WeakMap,S=new WeakMap,C=new WeakMap,M=new WeakMap,L=new WeakMap,b=new WeakSet,A=function(){wt(cast.framework.CastContextEventType.CAST_STATE_CHANGED,ht(this,b,G).bind(this))},I=function(){const t=cast.framework.RemotePlayerEventType,e={[t.IS_CONNECTED_CHANGED]:ht(this,b,G),[t.IS_MEDIA_LOADED_CHANGED]:ht(this,b,O),[t.CAN_CONTROL_VOLUME_CHANGED]:ht(this,b,$),[t.CAN_SEEK_CHANGED]:ht(this,b,x),[t.DURATION_CHANGED]:ht(this,b,H),[t.IS_MUTED_CHANGED]:ht(this,b,j),[t.VOLUME_LEVEL_CHANGED]:ht(this,b,j),[t.IS_PAUSED_CHANGED]:ht(this,b,B),[t.LIVE_SEEKABLE_RANGE_CHANGED]:ht(this,b,F),[t.PLAYER_STATE_CHANGED]:ht(this,b,X)};nt(this,C,e);const s=ht(this,b,W).bind(this);for(const i of lt(e))it(this,p).controller.addEventListener(i,s);ut(()=>{for(const t of lt(e))it(this,p).controller.removeEventListener(t,s)})},D=function(){it(this,M)||(nt(this,E,0),nt(this,w,new ot(0,0))),it(this,S).stop(),nt(this,g,0),nt(this,M,null)},_=function(){const t=new dt("resume-session",{detail:this.session});ht(this,b,O).call(this,t);const{muted:e,volume:s,savedState:i}=it(this,T).$state,a=i();this.setCurrentTime(Math.max(it(this,p).currentTime,(null==a?void 0:a.currentTime)??0)),this.setMuted(e()),this.setVolume(s()),!1===(null==a?void 0:a.paused)&&this.play()},N=function(){this.cast.endCurrentSession(!0);const{remotePlaybackLoader:t}=it(this,T).$state;t.set(null)},P=function(){const{savedState:t}=it(this,T).$state;t.set({paused:it(this,p).isPaused,currentTime:it(this,p).currentTime}),ht(this,b,N).call(this)},R=function(){ht(this,b,U).call(this)},W=function(t){it(this,C)[t.type].call(this,t)},G=function(t){const e=this.cast.getCastState(),s=e===cast.framework.CastState.CONNECTED?"connected":e===cast.framework.CastState.CONNECTING?"connecting":"disconnected";if(it(this,v)===s)return;const i={type:"google-cast",state:s},a=ht(this,b,Y).call(this,t);nt(this,v,s),it(this,T).notify("remote-playback-change",i,a),"disconnected"===s&&ht(this,b,P).call(this)},O=function(t){if(!!!it(this,p).isMediaLoaded)return;const e=mt(it(this,T).$state.source);Promise.resolve().then(()=>{if(e!==mt(it(this,T).$state.source)||!it(this,p).isMediaLoaded)return;ht(this,b,D).call(this);const s=it(this,p).duration;nt(this,w,new ot(0,s));const i={provider:this,duration:s,buffered:new ot(0,0),seekable:ht(this,b,K).call(this)},a=ht(this,b,Y).call(this,t);it(this,T).notify("loaded-metadata",void 0,a),it(this,T).notify("loaded-data",void 0,a),it(this,T).notify("can-play",i,a),ht(this,b,$).call(this),ht(this,b,x).call(this,t);const{volume:n,muted:h}=it(this,T).$state;this.setVolume(n()),this.setMuted(h()),it(this,S).start(),it(this,y).syncRemoteTracks(a),it(this,y).syncRemoteActiveIds(a)})},$=function(){it(this,T).$state.canSetVolume.set(it(this,p).canControlVolume)},x=function(t){const e=ht(this,b,Y).call(this,t);it(this,T).notify("stream-type-change",ht(this,b,V).call(this),e)},V=function(){var t;return(null==(t=it(this,p).mediaInfo)?void 0:t.streamType)===chrome.cast.media.StreamType.LIVE?it(this,p).canSeek?"live:dvr":"live":"on-demand"},U=function(){if(it(this,M))return;const t=it(this,p).currentTime;t!==it(this,g)&&(it(this,T).notify("time-change",t),t>it(this,E)&&(nt(this,E,t),ht(this,b,F).call(this)),it(this,T).$state.seeking()&&it(this,T).notify("seeked",t),nt(this,g,t))},H=function(t){if(!it(this,p).isMediaLoaded||it(this,M))return;const e=it(this,p).duration,s=ht(this,b,Y).call(this,t);nt(this,w,new ot(0,e)),it(this,T).notify("duration-change",e,s)},j=function(t){if(!it(this,p).isMediaLoaded)return;const e={muted:it(this,p).isMuted,volume:it(this,p).volumeLevel},s=ht(this,b,Y).call(this,t);it(this,T).notify("volume-change",e,s)},B=function(t){const e=ht(this,b,Y).call(this,t);it(this,p).isPaused?it(this,T).notify("pause",void 0,e):it(this,T).notify("play",void 0,e)},F=function(t){const e={seekable:ht(this,b,K).call(this),buffered:new ot(0,it(this,E))},s=t?ht(this,b,Y).call(this,t):void 0;it(this,T).notify("progress",e,s)},X=function(t){const e=it(this,p).playerState,s=chrome.cast.media.PlayerState;if(nt(this,L,e===s.IDLE),e===s.PAUSED)return;const i=ht(this,b,Y).call(this,t);switch(e){case s.PLAYING:it(this,T).notify("playing",void 0,i);break;case s.BUFFERING:it(this,T).notify("waiting",void 0,i);break;case s.IDLE:it(this,S).stop(),it(this,T).notify("pause"),it(this,T).notify("end")}},K=function(){return it(this,p).liveSeekableRange?new ot(it(this,p).liveSeekableRange.start,it(this,p).liveSeekableRange.end):it(this,w)},Y=function(t){return t instanceof Event?t:new dt(t.type,{detail:t})},q=function(t){const{streamType:e,title:s,poster:i}=it(this,T).$state;return new Ct(t).setMetadata(s(),i()).setStreamType(e()).setTracks(it(this,y).getLocalTextTracks()).build()},Q=function(t){var e,s;const i=ht(this,b,q).call(this,t),a=new chrome.cast.media.LoadRequest(i),n=it(this,T).$state.savedState();return a.autoplay=!1===((null==(e=it(this,M))?void 0:e.paused)??(null==n?void 0:n.paused)),a.currentTime=(null==(s=it(this,M))?void 0:s.time)??(null==n?void 0:n.currentTime)??0,a},z=async function(t,e){const s=mt(it(this,T).$state.source);nt(this,M,{src:s,paused:t,time:e}),await this.loadSource(s)},J=function(){ht(this,b,z).call(this,it(this,p).isPaused,it(this,p).currentTime).catch(t=>{})};export{Lt as GoogleCastProvider};
