var t,i,s,e,n,a,r,o,h,l,c,d,u,p,f,v,g,y,w,b,k,m,E,T,S,L,W,M,x,I,D,$,j=Object.defineProperty,_=t=>{throw TypeError(t)},A=(t,i,s)=>((t,i,s)=>i in t?j(t,i,{enumerable:!0,configurable:!0,writable:!0,value:s}):t[i]=s)(t,"symbol"!=typeof i?i+"":i,s),C=(t,i,s)=>i.has(t)||_("Cannot "+s),R=(t,i,s)=>(C(t,i,"read from private field"),s?s.call(t):i.get(t)),O=(t,i,s)=>i.has(t)?_("Cannot add the same private member more than once"):i instanceof WeakSet?i.add(t):i.set(t,s),P=(t,i,s,e)=>(C(t,i,"write to private field"),e?e.call(t,s):i.set(t,s),s),V=(t,i,s)=>(C(t,i,"access private method"),s);import{V as q,i as N,b as H,p as U,c as F,Q as B,l as K,e as Q,D as X,d as Y,R as z,T as G,f as J,L as Z,I as tt,g as it,h as st,j as et,k as nt}from"./main-BTcRghE5.js";import"./vendor-I5pfZzyJ.js";import"./mui-Du5OpAyb.js";import"./router-C70wdWFB.js";class at{constructor(r,o){O(this,a),O(this,t),O(this,i),O(this,s,null),O(this,e,null),A(this,"config",{}),O(this,n,new Set),P(this,t,r),P(this,i,o)}get instance(){return R(this,s)}setup(r){const{streamType:h}=R(this,i).$state,y=F(h).includes("live"),m=F(h).includes("ll-");P(this,s,new r({lowLatencyMode:m,backBufferLength:m?4:y?8:void 0,renderTextTracksNatively:!1,...this.config}));const E=V(this,a,l).bind(this);for(const t of Object.values(r.Events))R(this,s).on(t,E);R(this,s).on(r.Events.ERROR,V(this,a,g).bind(this));for(const t of R(this,n))t(R(this,s));R(this,i).player.dispatch("hls-instance",{detail:R(this,s)}),R(this,s).attachMedia(R(this,t)),R(this,s).on(r.Events.AUDIO_TRACK_SWITCHED,V(this,a,u).bind(this)),R(this,s).on(r.Events.LEVEL_SWITCHED,V(this,a,p).bind(this)),R(this,s).on(r.Events.LEVEL_LOADED,V(this,a,v).bind(this)),R(this,s).on(r.Events.LEVEL_UPDATED,V(this,a,f).bind(this)),R(this,s).on(r.Events.NON_NATIVE_TEXT_TRACKS_FOUND,V(this,a,c).bind(this)),R(this,s).on(r.Events.CUES_PARSED,V(this,a,d).bind(this)),R(this,i).qualities[B.enableAuto]=V(this,a,w).bind(this),K(R(this,i).qualities,"change",V(this,a,b).bind(this)),K(R(this,i).audioTracks,"change",V(this,a,k).bind(this)),P(this,e,Q(V(this,a,o).bind(this)))}onInstance(t){return R(this,n).add(t),()=>R(this,n).delete(t)}loadSource(t){var i;H(t.src)&&(null==(i=R(this,s))||i.loadSource(t.src))}destroy(){var t,i;null==(t=R(this,s))||t.destroy(),P(this,s,null),null==(i=R(this,e))||i.call(this),P(this,e,null)}}t=new WeakMap,i=new WeakMap,s=new WeakMap,e=new WeakMap,n=new WeakMap,a=new WeakSet,r=function(t,i){return new X((t=>Y(t))(t),{detail:i})},o=function(){if(!R(this,i).$state.live())return;const t=new z(V(this,a,h).bind(this));return t.start(),t.stop.bind(t)},h=function(){var t;R(this,i).$state.liveSyncPosition.set((null==(t=R(this,s))?void 0:t.liveSyncPosition)??1/0)},l=function(t,s){var e;null==(e=R(this,i).player)||e.dispatch(V(this,a,r).call(this,t,s))},c=function(t,e){const n=V(this,a,r).call(this,t,e);let o=-1;for(let a=0;a<e.tracks.length;a++){const t=e.tracks[a],r=t.subtitleTrack??t.closedCaptions,h=new G({id:`hls-${t.kind}-${a}`,src:null==r?void 0:r.url,label:t.label,language:null==r?void 0:r.lang,kind:t.kind,default:t.default});h[J.readyState]=2,h[J.onModeChange]=()=>{"showing"===h.mode?(R(this,s).subtitleTrack=a,o=a):o===a&&(R(this,s).subtitleTrack=-1,o=-1)},R(this,i).textTracks.add(h,n)}},d=function(t,e){var n;const o=null==(n=R(this,s))?void 0:n.subtitleTrack,h=R(this,i).textTracks.getById(`hls-${e.type}-${o}`);if(!h)return;const l=V(this,a,r).call(this,t,e);for(const i of e.cues)i.positionAlign="auto",h.addCue(i,l)},u=function(t,s){const e=R(this,i).audioTracks[s.id];if(e){const n=V(this,a,r).call(this,t,s);R(this,i).audioTracks[Z.select](e,!0,n)}},p=function(t,s){const e=R(this,i).qualities[s.level];if(e){const n=V(this,a,r).call(this,t,s);R(this,i).qualities[Z.select](e,!0,n)}},f=function(t,s){s.details.totalduration>0&&R(this,i).$state.inferredLiveDVRWindow.set(s.details.totalduration)},v=function(t,e){var n;if(R(this,i).$state.canPlay())return;const{type:o,live:h,totalduration:l,targetduration:c}=e.details,d=V(this,a,r).call(this,t,e);R(this,i).notify("stream-type-change",h?"EVENT"===o&&Number.isFinite(l)&&c>=10?"live:dvr":"live":"on-demand",d),R(this,i).notify("duration-change",l,d);const u=R(this,s).media;-1===R(this,s).currentLevel&&R(this,i).qualities[B.setAuto](!0,d);for(const a of R(this,s).audioTracks){const t={id:a.id.toString(),label:a.name,language:a.lang||"",kind:"main"};R(this,i).audioTracks[Z.add](t,d)}for(const a of R(this,s).levels){const t={id:(null==(n=a.id)?void 0:n.toString())??a.height+"p",width:a.width,height:a.height,codec:a.codecSet,bitrate:a.bitrate};R(this,i).qualities[Z.add](t,d)}u.dispatchEvent(new X("canplay",{trigger:d}))},g=function(t,i){var e;if(i.fatal)if("mediaError"===i.type)null==(e=R(this,s))||e.recoverMediaError();else V(this,a,y).call(this,i.error)},y=function(t){R(this,i).notify("error",{message:t.message,code:1,error:t})},w=function(){R(this,s)&&(R(this,s).currentLevel=-1)},b=function(){const{qualities:e}=R(this,i);R(this,s)&&!e.auto&&(R(this,s)[e.switch+"Level"]=e.selectedIndex,tt&&(R(this,t).currentTime=R(this,t).currentTime))},k=function(){const{audioTracks:t}=R(this,i);R(this,s)&&R(this,s).audioTrack!==t.selectedIndex&&(R(this,s).audioTrack=t.selectedIndex)};class rt{constructor(t,i,s){O(this,S),O(this,m),O(this,E),O(this,T),P(this,m,t),P(this,E,i),P(this,T,s),V(this,S,L).call(this)}}m=new WeakMap,E=new WeakMap,T=new WeakMap,S=new WeakSet,L=async function(){const t={onLoadStart:V(this,S,W).bind(this),onLoaded:V(this,S,M).bind(this),onLoadError:V(this,S,x).bind(this)};let i=await async function(t,i={}){var s,e,n;if(!H(t))return;null==(s=i.onLoadStart)||s.call(i);try{if(await et(t),!nt(window.Hls))throw Error("");const s=window.Hls;return null==(e=i.onLoaded)||e.call(i,s),s}catch(a){null==(n=i.onLoadError)||n.call(i,a)}return}(R(this,m),t);if(it(i)&&!H(R(this,m))&&(i=await async function(t,i={}){var s,e,n,a,r;if(it(t))return;if(null==(s=i.onLoadStart)||s.call(i),t.prototype&&t.prototype!==Function)return null==(e=i.onLoaded)||e.call(i,t),t;try{const s=null==(n=await t())?void 0:n.default;if(!s||!s.isSupported)throw Error("");return null==(a=i.onLoaded)||a.call(i,s),s}catch(o){null==(r=i.onLoadError)||r.call(i,o)}return}(R(this,m),t)),!i)return null;if(!i.isSupported()){const t="[vidstack] `hls.js` is not supported in this environment";return R(this,E).player.dispatch(new X("hls-unsupported")),R(this,E).notify("error",{message:t,code:4}),null}return i},W=function(){R(this,E).player.dispatch(new X("hls-lib-load-start"))},M=function(t){R(this,E).player.dispatch(new X("hls-lib-loaded",{detail:t})),R(this,T).call(this,t)},x=function(t){const i=st(t);R(this,E).player.dispatch(new X("hls-lib-load-error",{detail:i})),R(this,E).notify("error",{message:i.message,code:4,error:i})};class ot extends q{constructor(){super(...arguments),A(this,"$$PROVIDER_TYPE","HLS"),O(this,I,null),O(this,D,new at(this.video,this.ctx)),O(this,$,"https://cdn.jsdelivr.net/npm/hls.js@^1.5.0/dist/hls.min.js")}get ctor(){return R(this,I)}get instance(){return R(this,D).instance}get type(){return"hls"}get canLiveSync(){return!0}get config(){return R(this,D).config}set config(t){R(this,D).config=t}get library(){return R(this,$)}set library(t){P(this,$,t)}preconnect(){H(R(this,$))&&U(R(this,$))}setup(){super.setup(),new rt(R(this,$),this.ctx,t=>{P(this,I,t),R(this,D).setup(t),this.ctx.notify("provider-setup",this);const i=F(this.ctx.$state.source);i&&this.loadSource(i)})}async loadSource(t,i){H(t.src)?(this.media.preload=i||"",this.appendSource(t,"application/x-mpegurl"),R(this,D).loadSource(t),this.currentSrc=t):this.removeSource()}onInstance(t){const i=R(this,D).instance;return i&&t(i),R(this,D).onInstance(t)}destroy(){R(this,D).destroy()}}I=new WeakMap,D=new WeakMap,$=new WeakMap,A(ot,"supported",N());export{ot as HLSProvider};
